' Inferencia en Funciones
' - Ejecutar hasta "0012 enter 6" 
'   (doble-click sobre la instrucción)

push 10
push 82
push 94
call sumaIVA
add

pushf 4.5
call funcion2
jmp fin

funcion2:
' 4) Warnings. La información obtenida
' mediante inferencia se utiliza para
' detectar acciones sospechosas en 
' tiempo de ejecución.
'
' Ejemplo 1. El tamaño del parámetro
' es incorrecto: se ha pasado un real
' y debía ser un int
nop

push 26
push 1024
ret 0, 0, 2


' 1) Inferencia de Parámetros.
' Se utilizan los accesos a memoria
' para inferir dónde están los
' parámetros y las variables locales
' de las funciones.
' En este momento se ha inferido que
' el 82 y el 94 (pero no el 10) son
' los parámetros de la función (en
' violeta de 1018 a 1021). Se muestra
' también sus direcciones relativas
' (Param2 = BP+4 y Param1 = BP+6)
' 
sumaIVA:
enter 6
 
push bp
push 4
add

' 2) Conversión a direcciones relativas.
' En la cima de la pila hay una
' dirección absoluta. Detrás se
' indica que se corresponde con la
' dirección relativa "BP+4" e indica
' además que corresponde a Param2.
load
out

push bp
push -5
add
push 256
store

' 3) Inferencia de variables locales.
' Se resaltan en negrita los valores
' modificados por la última instrucción.
' En este caso se ha inferido una de
' las variables locales (la situada
' en 1009) y se muestra su dirección
' relativa (BP-5)
nop

push 100
ret 2, 6, 4


fin:
' Ejemplo 2. Al haber dejado la
' función valores sin retirar de
' la pila, el 'stack frame' (BP
' anterior y la dirección de retorno)
' no estaba donde se le esperaba y en
' su lugar se ha cogido basura de la
' pila
nop


halt

